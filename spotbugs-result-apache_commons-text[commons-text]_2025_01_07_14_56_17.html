
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta charset="UTF-8"/>
      <title>SpotBugs Report</title>
      <style type="text/css">
		.tablerow0 {
			background: #EEEEEE;
		}

		.tablerow1 {
			background: white;
		}

		.detailrow0 {
			background: #EEEEEE;
		}

		.detailrow1 {
			background: white;
		}

		.tableheader {
			background: #b9b9fe;
			font-size: larger;
		}
		</style>
   </head>
   <body>
      <h1>SpotBugs Report</h1>
      <p>Produced using <a href="https://spotbugs.github.io">SpotBugs</a>4.8.6.</p>
      <p>Project: 
			apache_commons-text[commons-text]</p>
      <h2>Metrics</h2>
      <p>13436 lines of code analyzed,
	in 195 classes, 
	in 9 packages.</p>
      <table width="500" cellpadding="5" cellspacing="2">
         <tr class="tableheader">
            <th align="left">Metric</th>
            <th align="right">Total</th>
            <th align="right">Density*</th>
         </tr>
         <tr class="tablerow0">
            <td>High Priority Warnings</td>
            <td align="right">7</td>
            <td align="right">0.52</td>
         </tr>
         <tr class="tablerow1">
            <td>Medium Priority Warnings</td>
            <td align="right">8</td>
            <td align="right">0.60</td>
         </tr>
         <tr class="$totalClass">
            <td>
               <b>Total Warnings</b>
            </td>
            <td align="right">
               <b>15</b>
            </td>
            <td align="right">
               <b>1.12</b>
            </td>
         </tr>
      </table>
      <p>
         <i>(* Defects per Thousand lines of non-commenting source statements)</i>
      </p>
      <p>
         <br/>
         <br/>
      </p>
      <h2>Summary</h2>
      <table width="500" cellpadding="5" cellspacing="2">
         <tr class="tableheader">
            <th align="left">Warning Type</th>
            <th align="right">Number</th>
         </tr>
         <tr class="tablerow0">
            <td>
               <a href="#Warnings_SECURITY">Security Warnings</a>
            </td>
            <td align="right">6</td>
         </tr>
         <tr class="tablerow1">
            <td>
               <a href="#Warnings_STYLE">Dodgy code Warnings</a>
            </td>
            <td align="right">9</td>
         </tr>
         <tr class="tablerow0">
            <td>
               <b>Total</b>
            </td>
            <td align="right">
               <b>15</b>
            </td>
         </tr>
      </table>
      <p>
         <br/>
         <br/>
      </p>
      <h1>Warnings</h1>
      <p>Click on each warning link to see a full description of the issue, and
	    details of how to resolve it.</p>
      <h2>
         <a name="Warnings_SECURITY">Security Warnings</a>
      </h2>
      <table class="warningtable"
             width="100%"
             cellspacing="2"
             cellpadding="5">
         <tr class="tableheader">
            <th align="left">Warning</th>
            <th align="left">Priority</th>
            <th align="left">Details</th>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#SCRIPT_ENGINE_INJECTION">Potential code injection when using Script Engine</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This use of javax/script/ScriptEngine.eval(Ljava/lang/String;)Ljava/lang/Object; can be vulnerable to code injection<br/>
                  <br/>
                  <br/>In file ScriptStringLookup.java ScriptStringLookup.java,
					
						line 86 73<br/>In class org.apache.commons.text.lookup.ScriptStringLookup<br/>In method org.apache.commons.text.lookup.ScriptStringLookup.lookup(String)<br/>At ScriptStringLookup.java:[line 86]<br/>Sink method javax/script/ScriptEngine.eval(Ljava/lang/String;)Ljava/lang/Object;<br/>Sink parameter 0<br/>Unknown source org/apache/commons/text/lookup/ScriptStringLookup.lookup(Ljava/lang/String;)Ljava/lang/String; parameter 0<br/>Method usage not detected<br/>At ScriptStringLookup.java:[line 73]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#PREDICTABLE_RANDOM">Predictable pseudorandom number generator</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This random generator (java.util.concurrent.ThreadLocalRandom) is predictable<br/>
                  <br/>
                  <br/>In file RandomStringGenerator.java,
					
						line 468<br/>In class org.apache.commons.text.RandomStringGenerator<br/>In method org.apache.commons.text.RandomStringGenerator.generateRandomNumber(int, int)<br/>At RandomStringGenerator.java:[line 468]<br/>Value java.util.concurrent.ThreadLocalRandom</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#PREDICTABLE_RANDOM">Predictable pseudorandom number generator</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This random generator (java.util.concurrent.ThreadLocalRandom) is predictable<br/>
                  <br/>
                  <br/>In file RandomStringGenerator.java,
					
						line 483<br/>In class org.apache.commons.text.RandomStringGenerator<br/>In method org.apache.commons.text.RandomStringGenerator.generateRandomNumber(List)<br/>At RandomStringGenerator.java:[line 483]<br/>Value java.util.concurrent.ThreadLocalRandom</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#PATH_TRAVERSAL_IN">Potential Path Traversal (file read)</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This API (java/nio/file/Paths.get(Ljava/lang/String;[Ljava/lang/String;)Ljava/nio/file/Path;) reads a file whose location might be specified by user input<br/>
                  <br/>
                  <br/>In file AbstractPathFencedLookup.java FileStringLookup.java PropertiesStringLookup.java PropertiesStringLookup.java XmlStringLookup.java XmlStringLookup.java,
					
						line 54 89 85 95 92 100<br/>In class org.apache.commons.text.lookup.AbstractPathFencedLookup<br/>In method org.apache.commons.text.lookup.AbstractPathFencedLookup.getPath(String)<br/>At AbstractPathFencedLookup.java:[line 54]<br/>Sink method java/nio/file/Paths.get(Ljava/lang/String;[Ljava/lang/String;)Ljava/nio/file/Path;<br/>Sink parameter 1<br/>Unknown source org/apache/commons/text/lookup/AbstractPathFencedLookup.getPath(Ljava/lang/String;)Ljava/nio/file/Path; parameter 0<br/>At FileStringLookup.java:[line 89]<br/>At PropertiesStringLookup.java:[line 85]<br/>At PropertiesStringLookup.java:[line 95]<br/>At XmlStringLookup.java:[line 92]<br/>At XmlStringLookup.java:[line 100]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#URLCONNECTION_SSRF_FD">URLConnection Server-Side Request Forgery (SSRF) and File Disclosure</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This web server request could be used by an attacker to expose internal services and filesystem.<br/>
                  <br/>
                  <br/>In file UrlStringLookup.java UrlStringLookup.java,
					
						line 79 75<br/>In class org.apache.commons.text.lookup.UrlStringLookup<br/>In method org.apache.commons.text.lookup.UrlStringLookup.lookup(String)<br/>At UrlStringLookup.java:[line 79]<br/>Sink method java/net/URL.openStream()Ljava/io/InputStream;<br/>Sink parameter 0<br/>Unknown source org/apache/commons/lang3/StringUtils.substringAfter(Ljava/lang/String;I)Ljava/lang/String;<br/>Unknown source java/net/URL.&lt;init&gt;(Ljava/lang/String;)V<br/>At UrlStringLookup.java:[line 75]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#XPATH_INJECTION">Potential XPath Injection</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This use of javax/xml/xpath/XPath.evaluate(Ljava/lang/String;Lorg/xml/sax/InputSource;)Ljava/lang/String; can be vulnerable to XPath Injection<br/>
                  <br/>
                  <br/>In file XmlStringLookup.java,
					
						line 105<br/>In class org.apache.commons.text.lookup.XmlStringLookup<br/>In method org.apache.commons.text.lookup.XmlStringLookup.lookup(String)<br/>At XmlStringLookup.java:[line 105]<br/>Sink method javax/xml/xpath/XPath.evaluate(Ljava/lang/String;Lorg/xml/sax/InputSource;)Ljava/lang/String;<br/>Sink parameter 1<br/>Unknown source org/apache/commons/lang3/StringUtils.substringAfter(Ljava/lang/String;I)Ljava/lang/String;</p>
            </td>
         </tr>
      </table>
      <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="Warnings_STYLE">Dodgy code Warnings</a>
      </h2>
      <table class="warningtable"
             width="100%"
             cellspacing="2"
             cellpadding="5">
         <tr class="tableheader">
            <th align="left">Warning</th>
            <th align="left">Priority</th>
            <th align="left">Details</th>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to targetLength in org.apache.commons.text.io.StringSubstitutorReader.drainHandler(int, TextStringBuilder, int, int, int)<br/>
                  <br/>
                  <br/>In file StringSubstitutorReader.java StringSubstitutorReader.java,
					
						line 269 269<br/>In class org.apache.commons.text.io.StringSubstitutorReader<br/>In method org.apache.commons.text.io.StringSubstitutorReader.drainHandler(int, TextStringBuilder, int, int, int)<br/>Local variable named targetLength<br/>At StringSubstitutorReader.java:[line 269]<br/>At StringSubstitutorReader.java:[line 269]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to startRndMask in org.apache.commons.text.jmh_generated.BenchmarkRunner_testLongStringCold_jmhTest.testLongStringCold_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_LongStringState_jmhType, BenchmarkRunner_jmhType)<br/>
                  <br/>
                  <br/>In file BenchmarkRunner_testLongStringCold_jmhTest.java BenchmarkRunner_testLongStringCold_jmhTest.java,
					
						line 289 289<br/>In class org.apache.commons.text.jmh_generated.BenchmarkRunner_testLongStringCold_jmhTest<br/>In method org.apache.commons.text.jmh_generated.BenchmarkRunner_testLongStringCold_jmhTest.testLongStringCold_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_LongStringState_jmhType, BenchmarkRunner_jmhType)<br/>Local variable named startRndMask<br/>At BenchmarkRunner_testLongStringCold_jmhTest.java:[line 289]<br/>At BenchmarkRunner_testLongStringCold_jmhTest.java:[line 289]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to startRndMask in org.apache.commons.text.jmh_generated.BenchmarkRunner_testLongString_jmhTest.testLongString_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_LongStringState_jmhType, BenchmarkRunner_jmhType)<br/>
                  <br/>
                  <br/>In file BenchmarkRunner_testLongString_jmhTest.java BenchmarkRunner_testLongString_jmhTest.java,
					
						line 289 289<br/>In class org.apache.commons.text.jmh_generated.BenchmarkRunner_testLongString_jmhTest<br/>In method org.apache.commons.text.jmh_generated.BenchmarkRunner_testLongString_jmhTest.testLongString_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_LongStringState_jmhType, BenchmarkRunner_jmhType)<br/>Local variable named startRndMask<br/>At BenchmarkRunner_testLongString_jmhTest.java:[line 289]<br/>At BenchmarkRunner_testLongString_jmhTest.java:[line 289]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to startRndMask in org.apache.commons.text.jmh_generated.BenchmarkRunner_testNormalStringCold_jmhTest.testNormalStringCold_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_NormalStringState_jmhType, BenchmarkRunner_jmhType)<br/>
                  <br/>
                  <br/>In file BenchmarkRunner_testNormalStringCold_jmhTest.java BenchmarkRunner_testNormalStringCold_jmhTest.java,
					
						line 289 289<br/>In class org.apache.commons.text.jmh_generated.BenchmarkRunner_testNormalStringCold_jmhTest<br/>In method org.apache.commons.text.jmh_generated.BenchmarkRunner_testNormalStringCold_jmhTest.testNormalStringCold_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_NormalStringState_jmhType, BenchmarkRunner_jmhType)<br/>Local variable named startRndMask<br/>At BenchmarkRunner_testNormalStringCold_jmhTest.java:[line 289]<br/>At BenchmarkRunner_testNormalStringCold_jmhTest.java:[line 289]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to startRndMask in org.apache.commons.text.jmh_generated.BenchmarkRunner_testNormalString_jmhTest.testNormalString_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_NormalStringState_jmhType, BenchmarkRunner_jmhType)<br/>
                  <br/>
                  <br/>In file BenchmarkRunner_testNormalString_jmhTest.java BenchmarkRunner_testNormalString_jmhTest.java,
					
						line 289 289<br/>In class org.apache.commons.text.jmh_generated.BenchmarkRunner_testNormalString_jmhTest<br/>In method org.apache.commons.text.jmh_generated.BenchmarkRunner_testNormalString_jmhTest.testNormalString_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_NormalStringState_jmhType, BenchmarkRunner_jmhType)<br/>Local variable named startRndMask<br/>At BenchmarkRunner_testNormalString_jmhTest.java:[line 289]<br/>At BenchmarkRunner_testNormalString_jmhTest.java:[line 289]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to startRndMask in org.apache.commons.text.jmh_generated.BenchmarkRunner_testReallyLongStringCold_jmhTest.testReallyLongStringCold_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_ReallyLongStringState_jmhType, BenchmarkRunner_jmhType)<br/>
                  <br/>
                  <br/>In file BenchmarkRunner_testReallyLongStringCold_jmhTest.java BenchmarkRunner_testReallyLongStringCold_jmhTest.java,
					
						line 289 289<br/>In class org.apache.commons.text.jmh_generated.BenchmarkRunner_testReallyLongStringCold_jmhTest<br/>In method org.apache.commons.text.jmh_generated.BenchmarkRunner_testReallyLongStringCold_jmhTest.testReallyLongStringCold_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_ReallyLongStringState_jmhType, BenchmarkRunner_jmhType)<br/>Local variable named startRndMask<br/>At BenchmarkRunner_testReallyLongStringCold_jmhTest.java:[line 289]<br/>At BenchmarkRunner_testReallyLongStringCold_jmhTest.java:[line 289]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
            </td>
            <td width="10%" valign="top">High</td>
            <td width="70%">
               <p>Dead store to startRndMask in org.apache.commons.text.jmh_generated.BenchmarkRunner_testReallyLongString_jmhTest.testReallyLongString_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_ReallyLongStringState_jmhType, BenchmarkRunner_jmhType)<br/>
                  <br/>
                  <br/>In file BenchmarkRunner_testReallyLongString_jmhTest.java BenchmarkRunner_testReallyLongString_jmhTest.java,
					
						line 289 289<br/>In class org.apache.commons.text.jmh_generated.BenchmarkRunner_testReallyLongString_jmhTest<br/>In method org.apache.commons.text.jmh_generated.BenchmarkRunner_testReallyLongString_jmhTest.testReallyLongString_sample_jmhStub(InfraControl, RawResults, BenchmarkParams, IterationParams, ThreadParams, Blackhole, Control, int, SampleBuffer, int, long, int, BenchmarkRunner_ReallyLongStringState_jmhType, BenchmarkRunner_jmhType)<br/>Local variable named startRndMask<br/>At BenchmarkRunner_testReallyLongString_jmhTest.java:[line 289]<br/>At BenchmarkRunner_testReallyLongString_jmhTest.java:[line 289]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#DCN_NULLPOINTER_EXCEPTION">NullPointerException caught</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>Do not catch NullPointerException like in org.apache.commons.text.lookup.BiFunctionStringLookup.lookup(String, Object)<br/>
                  <br/>
                  <br/>In file BiFunctionStringLookup.java,
					
						line 92<br/>In class org.apache.commons.text.lookup.BiFunctionStringLookup<br/>In method org.apache.commons.text.lookup.BiFunctionStringLookup.lookup(String, Object)<br/>At BiFunctionStringLookup.java:[line 92]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#DCN_NULLPOINTER_EXCEPTION">NullPointerException caught</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>Do not catch NullPointerException like in org.apache.commons.text.lookup.FunctionStringLookup.lookup(String)<br/>
                  <br/>
                  <br/>In file FunctionStringLookup.java,
					
						line 86<br/>In class org.apache.commons.text.lookup.FunctionStringLookup<br/>In method org.apache.commons.text.lookup.FunctionStringLookup.lookup(String)<br/>At FunctionStringLookup.java:[line 86]</p>
            </td>
         </tr>
      </table>
      <p>
         <br/>
         <br/>
      </p>
      <p>
         <br/>
         <br/>
      </p>
      <h1>
         <a name="Details">Warning Types</a>
      </h1>
      <h2>
         <a name="DCN_NULLPOINTER_EXCEPTION">NullPointerException caught</a>
      </h2>
   
<p>
According to SEI Cert rule <a href="https://wiki.sei.cmu.edu/confluence/display/java/ERR08-J.+Do+not+catch+NullPointerException+or+any+of+its+ancestors">ERR08-J</a> NullPointerException should not be caught. Handling NullPointerException is considered an inferior alternative to null-checking.
<p>
This non-compliant code catches a NullPointerException to see if an incoming parameter is null:
</p>
<pre><code>
boolean hasSpace(String m) {
  try {
    String ms[] = m.split(" ");
    return names.length != 1;
  } catch (NullPointerException e) {
    return false;
  }
}
</code></pre>
<p>
A compliant solution would use a null-check as in the following example:
</p>
<pre><code>
boolean hasSpace(String m) {
    if (m == null) return false;
    String ms[] = m.split(" ");
    return names.length != 1;
}
</code></pre>
    
     <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="DLS_DEAD_LOCAL_STORE">Dead store to local variable</a>
      </h2>

<p>
This instruction assigns a value to a local variable,
but the value is not read or used in any subsequent instruction.
Often, this indicates an error, because the value computed is never
used.
</p>
<p>
Note that Sun's javac compiler often generates dead stores for
final local variables. Because SpotBugs is a bytecode-based tool,
there is no easy way to eliminate these false positives.
</p>

    <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="SCRIPT_ENGINE_INJECTION">Potential code injection when using Script Engine</a>
      </h2>
            
<p>
    Dynamic code is being evaluated. A careful analysis of the code construction should be made. Malicious code execution
    could lead to data leakage or operating system compromised.
</p>
<p>
    If the evaluation of user code is intended, a proper sandboxing should be applied (see references).
</p>

<p><b>Code at risk:</b></p>
<p>
<pre>
public void runCustomTrigger(String script) {
    ScriptEngineManager factory = new ScriptEngineManager();
    ScriptEngine engine = factory.getEngineByName("JavaScript");

    engine.eval(script); //Bad things can happen here.
}</pre>
</p>

<p><b>Solution:</b></p>
<p>
Safe evaluation of JavaScript code using "Cloudbees Rhino Sandbox" library.<br/>
<pre>
public void runCustomTrigger(String script) {
    SandboxContextFactory contextFactory = new SandboxContextFactory();
    Context context = contextFactory.makeContext();
    contextFactory.enterContext(context);
    try {
        ScriptableObject prototype = context.initStandardObjects();
        prototype.setParentScope(null);
        Scriptable scope = context.newObject(prototype);
        scope.setPrototype(prototype);

        context.evaluateString(scope,script, null, -1, null);
    } finally {
        context.exit();
    }
}</pre>
</p>
<br/>
<p>
<b>References</b><br/>
<a href="https://github.com/cloudbees/rhino-sandbox">Cloudbees Rhino Sandbox</a>: Utility to create sandbox with Rhino (block access to all classes)<br/>
<a href="https://codeutopia.net/blog/2009/01/02/sandboxing-rhino-in-java/">CodeUtopia.net: Sandboxing Rhino in Java</a><br/>
<a href="https://blog.h3xstream.com/2014/11/remote-code-execution-by-design.html">Remote Code Execution .. by design</a>: Example of malicious payload. The samples given could be used to test sandboxing rules.<br/>
<a href="https://cwe.mitre.org/data/definitions/94.html">CWE-94: Improper Control of Generation of Code ('Code Injection')</a><br/>
<a href="https://cwe.mitre.org/data/definitions/95.html">CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')</a><br/>
</p>

        <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="PREDICTABLE_RANDOM">Predictable pseudorandom number generator</a>
      </h2>
            
<p>The use of a predictable random value can lead to vulnerabilities when used in certain security critical contexts. For example, when the value is used as:</p>
<ul>
<li>a CSRF token: a predictable token can lead to a CSRF attack as an attacker will know the value of the token</li>
<li>a password reset token (sent by email): a predictable password token can lead to an account takeover, since an attacker will guess the URL of the "change password" form</li>
<li>any other secret value</li>
</ul>
<p>
A quick fix could be to replace the use of <code>java.util.Random</code> with something stronger, such as <code>java.security.SecureRandom</code>.
</p>
<p>
<b>Vulnerable Code:</b><br/>
<pre>String generateSecretToken() {
    Random r = new Random();
    return Long.toHexString(r.nextLong());
}</pre>
</p>
<p>
<b>Solution:</b>
<pre>import org.apache.commons.codec.binary.Hex;

String generateSecretToken() {
    SecureRandom secRandom = new SecureRandom();

    byte[] result = new byte[32];
    secRandom.nextBytes(result);
    return Hex.encodeHexString(result);
}</pre>
</p>
<br/>
<p>
<b>References</b><br/>
<a href="https://jazzy.id.au/2010/09/20/cracking_random_number_generators_part_1.html">Cracking Random Number Generators - Part 1 (https://jazzy.id.au)</a><br/>
<a href="https://www.securecoding.cert.org/confluence/display/java/MSC02-J.+Generate+strong+random+numbers">CERT: MSC02-J. Generate strong random numbers</a><br/>
<a href="https://cwe.mitre.org/data/definitions/330.html">CWE-330: Use of Insufficiently Random Values</a><br/>
<a href="https://blog.h3xstream.com/2014/12/predicting-struts-csrf-token-cve-2014.html">Predicting Struts CSRF Token (Example of real-life vulnerability and exploitation)</a>
</p>

        <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="PATH_TRAVERSAL_IN">Potential Path Traversal (file read)</a>
      </h2>
            
<p>A file is opened to read its content. The filename comes from an <b>input</b> parameter.
If an unfiltered parameter is passed to this file API, files from an arbitrary filesystem location could be read.</p>
<p>This rule identifies <b>potential</b> path traversal vulnerabilities. In many cases, the constructed file path cannot be controlled
by the user. If that is the case, the reported instance is a false positive.</p>
<br/>

<p>
    <b>Vulnerable Code:</b><br/>
<pre>@GET
@Path("/images/{image}")
@Produces("images/*")
public Response getImage(@javax.ws.rs.PathParam("image") String image) {
    File file = new File("resources/images/", image); //Weak point

    if (!file.exists()) {
        return Response.status(Status.NOT_FOUND).build();
    }

    return Response.ok().entity(new FileInputStream(file)).build();
}</pre>
</p>
<br/>

<p>
    <b>Solution:</b><br/>
<pre>import org.apache.commons.io.FilenameUtils;

@GET
@Path("/images/{image}")
@Produces("images/*")
public Response getImage(@javax.ws.rs.PathParam("image") String image) {
    File file = new File("resources/images/", FilenameUtils.getName(image)); //Fix

    if (!file.exists()) {
        return Response.status(Status.NOT_FOUND).build();
    }

    return Response.ok().entity(new FileInputStream(file)).build();
}</pre>
</p>
<br/>
<p>
<b>References</b><br/>
<a href="http://projects.webappsec.org/w/page/13246952/Path%20Traversal">WASC: Path Traversal</a><br/>
<a href="https://www.owasp.org/index.php/Path_Traversal">OWASP: Path Traversal</a><br/>
<a href="https://capec.mitre.org/data/definitions/126.html">CAPEC-126: Path Traversal</a><br/>
<a href="https://cwe.mitre.org/data/definitions/22.html">CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')</a>
</p>

        <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="URLCONNECTION_SSRF_FD">URLConnection Server-Side Request Forgery (SSRF) and File Disclosure</a>
      </h2>
            
<p>
    Server-Side Request Forgery occur when a web server executes a request to a user supplied destination
    parameter that is not validated. Such vulnerabilities could allow an attacker to access internal services
    or to launch attacks from your web server.
</p>
<p>
    URLConnection can be used with file:// protocol or other protocols to access local filesystem and potentially other services.
<p>
    <b>Vulnerable Code:</b>
<pre>
new URL(String url).openConnection()
</pre>

<pre>
new URL(String url).openStream()
</pre>

<pre>
new URL(String url).getContent()
</pre>
</p>
<p>
    <b>Solution/Countermeasures:</b><br/>
    <ul>
        <li>Don't accept URL destinations from users</li>
        <li>Accept a destination key, and use it to look up the target destination associate with the key</li>
        <li>White list URLs (if possible)</li>
        <li>Validate that the beginning of the URL is part of a white list</li>
    </ul>
</p>
<br/>
<p>
<b>References</b><br/>
<a href="https://cwe.mitre.org/data/definitions/918.html">CWE-918: Server-Side Request Forgery (SSRF)</a><br/>
<a href="https://www.bishopfox.com/blog/2015/04/vulnerable-by-design-understanding-server-side-request-forgery/">Understanding Server-Side Request Forgery</a><br/>
<a href="https://cwe.mitre.org/data/definitions/73.html">CWE-73: External Control of File Name or Path</a><br/>
<a href="https://www.pwntester.com/blog/2013/11/28/abusing-jar-downloads/">Abusing jar:// downloads</a><br />
</p>
            <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="XPATH_INJECTION">Potential XPath Injection</a>
      </h2>
            
<p>
XPath injection risks are similar to SQL injection. If the XPath query contains untrusted user input, the complete data source
could be exposed. This could allow an attacker to access unauthorized data or maliciously modify the target XML.
</p>
<br/>
<p>
<b>References</b><br/>
<a href="http://projects.webappsec.org/w/page/13246963/SQL%20Injection">WASC-39: XPath Injection</a><br/>
<a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection">OWASP: Top 10 2013-A1-Injection</a><br/>
<a href="https://cwe.mitre.org/data/definitions/643.html">CWE-643: Improper Neutralization of Data within XPath Expressions ('XPath Injection')</a><br/>
<a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61407250">CERT: IDS09-J. Prevent XPath Injection (archive)</a><br/>
<a href="https://media.blackhat.com/bh-eu-12/Siddharth/bh-eu-12-Siddharth-Xpath-WP.pdf">Black Hat Europe 2012: Hacking XPath 2.0</a><br/>
<a href="https://www.balisage.net/Proceedings/vol7/html/Vlist02/BalisageVol7-Vlist02.html">Balisage.net: XQuery Injection</a>
</p>

        <p>
         <br/>
         <br/>
      </p>
   </body>
</html>
